<Page x:Class="Uno.AzureDevOps.Views.Content.ProjectPage"
	  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	  xmlns:win="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	  xmlns:xamarin="http://nventive.com/xamarin"
	  mc:Ignorable="xamarin">

	<Page.Resources>

		<!-- Team ComboBoxItem Style -->
		<DataTemplate x:Key="TeamComboBoxItemTemplate">
			<Grid Background="{StaticResource Color02Brush}"
				  BorderBrush="{StaticResource Color07Brush}"
				  BorderThickness="0,0,0,1"
				  Height="{StaticResource SmallComboBoxHeight}">

				<!-- Name -->
				<TextBlock Text="{Binding Name}"
						   Style="{StaticResource Typo03}"
						   VerticalAlignment="Center"
						   Margin="16,0" />
			</Grid>
		</DataTemplate>

		<!-- Sprint ComboBoxItem Style -->
		<DataTemplate x:Key="SprintComboBoxItemTemplate">
			<Grid Background="{StaticResource Color02Brush}"
				  HorizontalAlignment="Stretch"
				  BorderBrush="{StaticResource Color07Brush}"
				  BorderThickness="0,0,0,1"
				  win:Margin="0,0,0,1"
				  Padding="16,8">
				<StackPanel VerticalAlignment="Center">
					<!-- Name -->
					<TextBlock Text="{Binding Name}"
							   Style="{StaticResource Typo03}" />

					<!-- TimeSpan -->
					<StackPanel Orientation="Horizontal"
								Visibility="{Binding Text, ElementName=StartDateTxt, Converter={StaticResource EmptyStringToCollapsed}, FallbackValue=Collapsed}">

						<TextBlock x:Name="StartDateTxt"
								   Text="{Binding Attributes.StartDate, Converter={StaticResource DateToISODate}}"
								   Style="{StaticResource Typo12}" />
						<TextBlock Text="-"
								   Style="{StaticResource Typo12}"
								   Margin="3,0" />
						<TextBlock Text="{Binding Attributes.FinishDate, Converter={StaticResource DateToISODate}}"
								   Style="{StaticResource Typo12}" />
					</StackPanel>
				</StackPanel>
			</Grid>
		</DataTemplate>

		<DataTemplate x:Key="WorkItemTemplate">
			<StackPanel>
				<Grid Height="40">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition Width="*" />
					</Grid.ColumnDefinitions>

					<!-- Icon -->
					<Path Data="{Binding Item.WorkItemType, Converter={StaticResource WorkItemTypeToIconPath}}"
						  Fill="{Binding Item.WorkItemType, Converter={StaticResource WorkItemTypeToIconColor}}"
						  Height="24"
						  Width="17"
						  VerticalAlignment="Center"
						  Margin="18,8,0,0" />

					<!-- Title -->
					<TextBlock Text="{Binding Item.Title}"
							   Style="{StaticResource Typo05}"
							   MaxLines="1"
							   VerticalAlignment="Center"
							   TextWrapping="NoWrap"
							   Margin="10,0"
							   Grid.Column="1" />
				</Grid>

				<!-- Separator -->
				<Rectangle Height="1"
						   Fill="{StaticResource Color07Brush}"
						   Margin="16,1,0,0" />
			</StackPanel>
		</DataTemplate>
	</Page.Resources>

	<Grid Background="{StaticResource Color02Brush}">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<VisualStateManager.VisualStateGroups>
			<VisualStateGroup>
				<VisualState x:Name="wide">
					<VisualState.StateTriggers>
						<AdaptiveTrigger MinWindowWidth="700" />
					</VisualState.StateTriggers>

					<VisualState.Setters>
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
		</VisualStateManager.VisualStateGroups>

		<!-- CommandBar -->
		<CommandBar Content="{Binding SelectedProjectName}">
			<CommandBar.PrimaryCommands>

				<!-- Profile Button -->
				<AppBarButton Style="{StaticResource UserProfileButtonStyle}"
							  Command="{Binding ToProfilePage}" />
			</CommandBar.PrimaryCommands>
		</CommandBar>

		<!-- Loading State -->
		<Grid Visibility="{Binding LoadingSuccess, Converter={StaticResource TrueToCollapsed}, FallbackValue=Collapsed, TargetNullValue=Collapsed}"
			  Background="{StaticResource Color02Brush}"
			  Grid.Row="1">

			<StackPanel VerticalAlignment="Center"
						HorizontalAlignment="Center">

				<!-- Progress Ring -->
				<ProgressRing IsActive="{Binding LoadingSuccess, Converter={StaticResource BoolToInvertBool}}"
							  Foreground="{StaticResource Color03Brush}"
							  Height="20"
							  Width="20"
							  HorizontalAlignment="Center"
							  VerticalAlignment="Center"
							  Margin="0,12" />

				<!-- Verifying Message -->
				<TextBlock Text="Loading..."
						   Style="{StaticResource Typo08}" />
			</StackPanel>
		</Grid>

		<!-- Error State -->
		<Grid Visibility="{Binding Teams.IsFaulted, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed}"
			  Background="{StaticResource Color07Brush}"
			  Grid.Row="1">

			<!-- Message -->
			<TextBlock Text="An error occurred, please reload to try again."
					   Style="{StaticResource Typo10}"
					   HorizontalAlignment="Center"
					   VerticalAlignment="Center"
					   TextAlignment="Center"
					   Margin="50,0,50,48" />

			<!-- Reload button -->
			<Button Content="Reload"
					Command="{Binding ReloadPage}"
					Style="{StaticResource ReloadButtonStyle}"
					VerticalAlignment="Bottom"
					Margin="16,22" />
		</Grid>

		<!-- Content -->
		<Grid x:Name="RootLayout"
			  Visibility="{Binding LoadingSuccess, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed, UpdateSourceTrigger=PropertyChanged}"
			  Background="{StaticResource Color02Brush}"
			  Grid.Row="1">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>

			<!-- Teams ComboBox -->
			<!-- The combobox is disabled if only one item exists in its list -->
			<ComboBox ItemsSource="{Binding Teams.Result}"
					  SelectedItem="{Binding SelectedTeam, Mode=TwoWay}"
					  ItemTemplate="{StaticResource TeamComboBoxItemTemplate}"
					  Height="{StaticResource SmallComboBoxHeight}"
					  IsEnabled="{Binding Teams.Result, Converter={StaticResource EnumerableHasMinimumToTrue}}"
					  xamarin:DeferLoadStrategy="Lazy" />

			<!-- Navigation tabs -->
			<Grid BorderBrush="{StaticResource Color07Brush}"
				  BorderThickness="0,0,0,1"
				  Grid.Row="1">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="*" />
				</Grid.ColumnDefinitions>

				<!-- Srpint View Tab -->
				<RadioButton x:Name="SprintBtn"
							 GroupName="ViewTabsThin"
							 Content="Sprint"
							 IsChecked="{Binding Path=CurrentView, Mode=TwoWay, Converter={StaticResource ProjectViewToIsCheckedConverter}, ConverterParameter=Sprint}"
							 Grid.Column="0" />

				<!-- Members View Tab -->
				<RadioButton x:Name="MembersBtn"
							 GroupName="ViewTabsThin"
							 Content="Members"
							 IsChecked="{Binding Path=CurrentView, Mode=TwoWay, Converter={StaticResource ProjectViewToIsCheckedConverter}, ConverterParameter=Members}"
							 Grid.Column="1" />
			</Grid>

			<!-- Sprint -->
			<Grid Visibility="{Binding IsChecked,ElementName=SprintBtn, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed}"
				  Grid.Row="2">
				<Grid.RowDefinitions>
					<RowDefinition Height="64" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>

				<!-- Iterations ComboBox -->
				<!-- The combobox is disabled if only one item exists in its list -->
				<ComboBox Visibility="{Binding Iterations.IsSuccess, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed}"
						  ItemsSource="{Binding Iterations.Result}"
						  IsEnabled="{Binding Iterations.Result, Converter={StaticResource EnumerableHasMinimumToTrue}}"
						  SelectedItem="{Binding SelectedIteration, Mode=TwoWay}"
						  ItemTemplate="{StaticResource SprintComboBoxItemTemplate}"
						  Height="{StaticResource LargeComboBoxHeight}"
						  xamarin:DeferLoadStrategy="Lazy" />

				<!-- No Sprint State -->
				<Grid Visibility="{Binding Iterations.Result, Converter={StaticResource EnumerableHasAnyToCollapsed}, FallbackValue=Collapsed }"
					  Background="{StaticResource Color02Brush}"
					  BorderBrush="{StaticResource Color07Brush}"
					  BorderThickness="0,0,0,1">
					<StackPanel VerticalAlignment="Center"
								Margin="16,0">

						<!-- Name -->
						<TextBlock Text="No sprint available"
								   Style="{StaticResource Typo03}" />

						<!-- TimeSpan -->
						<TextBlock Text="N.A."
								   Style="{StaticResource Typo12}" />
					</StackPanel>
				</Grid>

				<!-- Loading State -->
				<Grid Visibility="{Binding Iterations.IsExecuting, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed}"
					  Background="{StaticResource Color02Brush}"
					  BorderBrush="{StaticResource Color07Brush}"
					  BorderThickness="0,0,0,1">

					<!-- Progress Ring -->
					<ProgressRing IsActive="{Binding Iterations.IsExecuting}"
								  Foreground="{StaticResource Color03Brush}"
								  Height="20"
								  Width="20"
								  HorizontalAlignment="Center"
								  VerticalAlignment="Center"
								  Margin="0,12" />

				</Grid>

				<!-- Work Items List -->
				<ListView ItemsSource="{Binding IterationWorkItems.Result}"
						  ItemTemplate="{StaticResource WorkItemTemplate}"
						  IsItemClickEnabled="True"
						  ItemClick="ListView_ItemClick"
						  Grid.Row="1"
						  Padding="0,0,0,80"/>

				<!-- Empty List Message -->
				<TextBlock Text="No work items in this iteration"
						   Visibility="{Binding IterationWorkItems.Result, Converter={StaticResource EnumerableHasAnyToCollapsed}, FallbackValue=Collapsed}"
						   Style="{StaticResource Typo15}"
						   Margin="16,12"
						   Grid.Row="1" />

				<!-- Loading State -->
				<Grid Visibility="{Binding IterationWorkItems.IsExecuting, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed}"
					  Grid.Row="1">

					<StackPanel VerticalAlignment="Center"
								HorizontalAlignment="Center">

						<!-- Progress Ring -->
						<ProgressRing IsActive="{Binding IterationWorkItems.IsExecuting}"
									  Foreground="{StaticResource Color03Brush}"
									  Height="20"
									  Width="20"
									  HorizontalAlignment="Center"
									  VerticalAlignment="Center"
									  Margin="0,12" />

						<!-- Verifying Message -->
						<TextBlock Text="Loading..."
								   Style="{StaticResource Typo08}" />
					</StackPanel>
				</Grid>
			</Grid>

			<!-- Members -->
			<Grid Visibility="{Binding IsChecked, ElementName=MembersBtn, Converter={StaticResource TrueToVisible}}"
				  Grid.Row="2">

				<!-- Project Members -->
				<ListView ItemsSource="{Binding TeamMembers.Result}"
						  IsItemClickEnabled="False"
						  SelectionMode="None">
					<ListView.ItemTemplate>
						<DataTemplate>
							<Grid>
								<StackPanel>
									<Grid Background="Transparent"
										  Height="56">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="Auto" />
											<ColumnDefinition Width="*" />
										</Grid.ColumnDefinitions>

										<!-- Project Member Image -->
										<Grid Background="{StaticResource Color07Brush}"
											  Height="32"
											  Width="32"
											  CornerRadius="16"
											  VerticalAlignment="Center"
											  Margin="16,0,0,0"
											  Grid.Column="0">

											<!-- Initials -->
											<TextBlock Text="{Binding Identity.DisplayName, Converter={StaticResource MemberInitials}}"
													   Style="{StaticResource MemberInitialsTextBlock}" />

											<!-- Profile image -->
											<Grid Height="32"
												  Width="32"
												  CornerRadius="16">
												<Grid.Background>
													<ImageBrush ImageSource="{Binding Identity.Links.Links[avatar].Href}" />
												</Grid.Background>
											</Grid>
										</Grid>

										<!-- Project Member Name -->
										<TextBlock Text="{Binding Identity.DisplayName}"
												   Style="{StaticResource Typo08}"
												   VerticalAlignment="Center"
												   Margin="10,0,0,0"
												   MaxLines="1"
												   Grid.Column="1" />
									</Grid>

									<!-- Separator -->
									<Rectangle Height="1"
											   Fill="{StaticResource Color07Brush}"
											   Margin="16,1,0,0" />
								</StackPanel>
							</Grid>
						</DataTemplate>
					</ListView.ItemTemplate>
				</ListView>

				<!-- Empty List Message -->
				<TextBlock Text="No members in this project"
						   Visibility="{Binding TeamMembers.Result, Converter={StaticResource EnumerableHasAnyToCollapsed}, FallbackValue=Collapsed}"
						   Style="{StaticResource Typo15}"
						   Margin="16,12" />

				<!-- Loading State -->
				<Grid Visibility="{Binding TeamMembers.IsExecuting, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed}">

					<StackPanel VerticalAlignment="Center"
								HorizontalAlignment="Center">

						<!-- Progress Ring -->
						<ProgressRing IsActive="{Binding TeamMembers.IsExecuting}"
									  Foreground="{StaticResource Color03Brush}"
									  Height="20"
									  Width="20"
									  HorizontalAlignment="Center"
									  VerticalAlignment="Center"
									  Margin="0,12" />

						<!-- Verifying Message -->
						<TextBlock Text="Loading..."
								   Style="{StaticResource Typo08}" />
					</StackPanel>
				</Grid>
			</Grid>
		</Grid>
	</Grid>
</Page>
